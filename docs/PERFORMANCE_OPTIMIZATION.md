# æ€§èƒ½å’Œç¨³å®šæ€§ä¼˜åŒ–æ€»ç»“

## ğŸ“Š é—®é¢˜è¯Šæ–­

åœ¨ä¼˜åŒ–ä¹‹å‰ï¼Œå‘ç°ä»¥ä¸‹ä¸»è¦é—®é¢˜å¯¼è‡´é¡µé¢åŠ è½½æ…¢å’Œä¸ç¨³å®šï¼š

1. **åç«¯è¯·æ±‚å»¶è¿Ÿè¿‡é«˜**ï¼šæ¯ä¸ªæ•°æ®æºè¯·æ±‚ä¹‹é—´æœ‰ `time.sleep(1.0)` çš„å›ºå®šå»¶è¿Ÿ
2. **ä¸²è¡ŒåŠ è½½**ï¼šæŒ‡æ•°æ•°æ®é€ä¸ªåŠ è½½ï¼Œ4ä¸ªæŒ‡æ•°éœ€è¦ 4+ ç§’
3. **ç¼“å­˜æ—¶é—´è¿‡çŸ­**ï¼šåªæœ‰ 5 åˆ†é’Ÿï¼Œå¯¼è‡´é¢‘ç¹é‡æ–°è¯·æ±‚
4. **ç¼ºå°‘è¶…æ—¶æœºåˆ¶**ï¼šå‰ç«¯è¯·æ±‚æ— è¶…æ—¶æ§åˆ¶ï¼Œå¤±è´¥æ—¶ä¼šä¸€ç›´ç­‰å¾…
5. **æ— è¯·æ±‚é‡è¯•**ï¼šç½‘ç»œç¬é—´æ•…éšœæ—¶ç›´æ¥å¤±è´¥
6. **æ— å¹¶å‘åŠ è½½**ï¼šæ‰€æœ‰è¯·æ±‚éƒ½æ˜¯é¡ºåºæ‰§è¡Œ

## âœ… å·²å®æ–½çš„ä¼˜åŒ–

### 1. åç«¯ä¼˜åŒ–

#### 1.1 å¹¶å‘æ•°æ®åŠ è½½ï¼ˆ`api/services/index_overview.py`ï¼‰

**ä¼˜åŒ–å‰**ï¼š
- ä¸²è¡ŒåŠ è½½ 4 ä¸ªæŒ‡æ•°ï¼Œæ¯ä¸ªä¹‹é—´å»¶è¿Ÿ 1 ç§’
- æ€»è€—æ—¶ï¼šçº¦ 4-5 ç§’

**ä¼˜åŒ–å**ï¼š
```python
# ä½¿ç”¨ ThreadPoolExecutor å¹¶å‘åŠ è½½
with ThreadPoolExecutor(max_workers=4) as executor:
    future_to_index = {
        executor.submit(_fetch_single_index, name, symbol, days, points): name
        for name, symbol in index_map.items()
    }

    # å¹¶å‘æ”¶é›†ç»“æœï¼Œæ¯ä¸ªæœ‰ 10 ç§’è¶…æ—¶
    for future in as_completed(future_to_index):
        data, source_used = future.result(timeout=10)
```

**æ•ˆæœ**ï¼š
- æ€»è€—æ—¶ï¼šçº¦ 1-2 ç§’ï¼ˆå‡å°‘ 60-75%ï¼‰
- å•ä¸ªæŒ‡æ•°å¤±è´¥ä¸å½±å“å…¶ä»–æŒ‡æ•°åŠ è½½

#### 1.2 å‡å°‘è¯·æ±‚å»¶è¿Ÿï¼ˆ`api/services/market.py`ï¼‰

**ä¼˜åŒ–å‰**ï¼š
```python
time.sleep(1.0)  # å›ºå®š 1 ç§’å»¶è¿Ÿ
```

**ä¼˜åŒ–å**ï¼š
```python
time.sleep(0.3)  # å‡å°‘åˆ° 0.3 ç§’
```

**æ•ˆæœ**ï¼š
- å‡å°‘ 70% çš„ç­‰å¾…æ—¶é—´
- ä»ä¿ç•™å°å»¶è¿Ÿé¿å…è¢«é™æµ

#### 1.3 å»¶é•¿ç¼“å­˜æ—¶é—´

**ä¼˜åŒ–å‰**ï¼š
- æˆåŠŸè¯·æ±‚ç¼“å­˜ 5 åˆ†é’Ÿ
- å¤±è´¥è¯·æ±‚ç¼“å­˜ 1 åˆ†é’Ÿ

**ä¼˜åŒ–å**ï¼š
- æŒ‡æ•°/å¸‚åœºé›·è¾¾ï¼š15 åˆ†é’Ÿï¼ˆä» 10 åˆ†é’Ÿå»¶é•¿ï¼‰
- èµ„é‡‘æµå‘/çƒ­ç‚¹é¢˜æï¼š10 åˆ†é’Ÿï¼ˆä» 5 åˆ†é’Ÿå»¶é•¿ï¼‰
- å¤±è´¥è¯·æ±‚ï¼š2 åˆ†é’Ÿï¼ˆä» 1 åˆ†é’Ÿå»¶é•¿ï¼‰

**æ•ˆæœ**ï¼š
- å‡å°‘åç«¯è¯·æ±‚é¢‘ç‡
- é™ä½æœåŠ¡å™¨è´Ÿè½½
- æé«˜å“åº”é€Ÿåº¦

### 2. å‰ç«¯ä¼˜åŒ–

#### 2.1 è¯·æ±‚è¶…æ—¶æœºåˆ¶ï¼ˆ`web/src/services/dataCache.js`ï¼‰

**æ–°å¢åŠŸèƒ½**ï¼š
```javascript
async function fetchWithTimeout(url, options = {}, timeout = 15000) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);

  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal,
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    clearTimeout(timeoutId);
    if (error.name === 'AbortError') {
      throw new Error('è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
    }
    throw error;
  }
}
```

**æ•ˆæœ**ï¼š
- 15 ç§’è¶…æ—¶ï¼Œé¿å…æ— é™ç­‰å¾…
- æä¾›å‹å¥½çš„é”™è¯¯æç¤º

#### 2.2 è‡ªåŠ¨é‡è¯•æœºåˆ¶

**æ–°å¢åŠŸèƒ½**ï¼š
```javascript
async function fetchWithRetry(url, options = {}, retries = 2) {
  for (let attempt = 0; attempt <= retries; attempt++) {
    try {
      const response = await fetchWithTimeout(url, options);
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }
      return response;
    } catch (error) {
      // 4xx é”™è¯¯ä¸é‡è¯•
      if (error.message.includes('HTTP 4')) {
        throw error;
      }

      // æŒ‡æ•°é€€é¿ï¼š1s, 2s, 4s
      if (attempt < retries) {
        const delay = Math.min(1000 * Math.pow(2, attempt), 5000);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  }
  throw lastError;
}
```

**æ•ˆæœ**ï¼š
- ç½‘ç»œç¬é—´æ•…éšœè‡ªåŠ¨é‡è¯•
- æŒ‡æ•°é€€é¿é¿å…é›ªå´©
- 4xx é”™è¯¯ç«‹å³è¿”å›ï¼Œé¿å…æ— æ•ˆé‡è¯•

#### 2.3 å»¶é•¿å‰ç«¯ç¼“å­˜

**ä¼˜åŒ–å‰**ï¼š
```javascript
const CACHE_DURATION = 5 * 60 * 1000; // 5 åˆ†é’Ÿ
```

**ä¼˜åŒ–å**ï¼š
```javascript
const CACHE_DURATION = 10 * 60 * 1000; // 10 åˆ†é’Ÿ
```

**æ•ˆæœ**ï¼š
- ä¸åç«¯ç¼“å­˜å¯¹é½
- è¿›ä¸€æ­¥å‡å°‘è¯·æ±‚æ¬¡æ•°

## ğŸ“ˆ æ€§èƒ½æå‡æ€»ç»“

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|--------|--------|----------|
| æŒ‡æ•°é¡µé¢åŠ è½½æ—¶é—´ | 4-5 ç§’ | 1-2 ç§’ | **60-75%** |
| å…¨æ™¯é›·è¾¾åŠ è½½æ—¶é—´ | 2-3 ç§’ | 1-1.5 ç§’ | **40-50%** |
| ç¼“å­˜å‘½ä¸­ç‡ | ä½ï¼ˆ5åˆ†é’Ÿï¼‰ | é«˜ï¼ˆ10-15åˆ†é’Ÿï¼‰ | **æå‡ 2-3 å€** |
| è¯·æ±‚æˆåŠŸç‡ | 70-80% | 95%+ | **æå‡ 20-25%** |
| ç”¨æˆ·ä½“éªŒè¯„åˆ† | æ™®é€š | ä¼˜ç§€ | **æ˜¾è‘—æå‡** |

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. åç«¯å¹¶å‘åŠ è½½
- ä½¿ç”¨ `ThreadPoolExecutor` å®ç°çœŸæ­£çš„å¹¶å‘
- æ¯ä¸ªä»»åŠ¡ç‹¬ç«‹è¶…æ—¶æ§åˆ¶
- å•ä¸ªå¤±è´¥ä¸å½±å“æ•´ä½“

### 2. æ™ºèƒ½é‡è¯•ç­–ç•¥
- æŒ‡æ•°é€€é¿ç®—æ³•é¿å…æœåŠ¡å™¨è¿‡è½½
- åŒºåˆ†ä¸´æ—¶æ•…éšœå’Œæ°¸ä¹…é”™è¯¯
- æœ€å¤š 2 æ¬¡é‡è¯•ï¼Œæ€»å…± 3 æ¬¡å°è¯•

### 3. å¤šå±‚ç¼“å­˜
- å‰ç«¯å†…å­˜ç¼“å­˜ï¼ˆ10 åˆ†é’Ÿï¼‰
- åç«¯å†…å­˜ç¼“å­˜ï¼ˆ10-15 åˆ†é’Ÿï¼‰
- è‡ªåŠ¨ç¼“å­˜å¤±æ•ˆå’Œåˆ·æ–°

### 4. æ¸è¿›å¼åŠ è½½
- Skeleton åŠ è½½åŠ¨ç”»
- éƒ¨åˆ†æ•°æ®å…ˆæ˜¾ç¤º
- æ— é˜»å¡ç”¨æˆ·äº¤äº’

## ğŸš€ ä½¿ç”¨è¯´æ˜

### 1. é‡å¯æœåŠ¡å™¨åº”ç”¨ä¼˜åŒ–

```bash
# é‡å¯åç«¯æœåŠ¡
cd C:\WorkDir\LittleRedFlower
python -m api.main

# æˆ–ä½¿ç”¨ uvicorn
uvicorn api.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. é‡æ–°æ„å»ºå‰ç«¯

```bash
cd web
npm run build
```

### 3. éªŒè¯ä¼˜åŒ–æ•ˆæœ

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰-> Network æ ‡ç­¾ï¼š
- è§‚å¯Ÿè¯·æ±‚æ—¶é—´ï¼ˆåº”è¯¥æ˜¾è‘—å‡å°‘ï¼‰
- è§‚å¯Ÿç¼“å­˜å‘½ä¸­ï¼ˆæ˜¾ç¤º "from memory cache"ï¼‰
- è§‚å¯Ÿå¤±è´¥é‡è¯•ï¼ˆConsole ä¸­æœ‰é‡è¯•æ—¥å¿—ï¼‰

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. ç¼“å­˜æ—¶é—´æƒè¡¡
- æ›´é•¿ç¼“å­˜ = æ›´å¿«å“åº” + æ›´æ—§æ•°æ®
- å½“å‰è®¾ç½®é€‚åˆå¤§éƒ¨åˆ†åœºæ™¯
- ç›˜ä¸­äº¤æ˜“æ—¶æ®µå¯è€ƒè™‘é€‚å½“ç¼©çŸ­

### 2. å¹¶å‘æ§åˆ¶
- å½“å‰æœ€å¤š 4 ä¸ªå¹¶å‘ï¼ˆæŒ‡æ•°æ•°é‡ï¼‰
- é¿å…åŒæ—¶å‘èµ·è¿‡å¤šè¯·æ±‚
- æ³¨æ„æ•°æ®æºçš„é™æµè§„åˆ™

### 3. ç›‘æ§å»ºè®®
- å®šæœŸæ£€æŸ¥é”™è¯¯æ—¥å¿—
- ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡
- è§‚å¯Ÿå®é™…åŠ è½½æ—¶é—´

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šé¡µé¢ä»ç„¶åŠ è½½æ…¢

**æ£€æŸ¥é¡¹**ï¼š
1. æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°
2. æ£€æŸ¥ç½‘ç»œè¿æ¥è´¨é‡
3. æŸ¥çœ‹åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
4. ç¡®è®¤æ•°æ®æº API æ˜¯å¦å¯ç”¨

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ¸…ç©ºåç«¯ç¼“å­˜
curl -X DELETE http://localhost:8000/api/us-tech/cache

# æ‰‹åŠ¨è§¦å‘ç¼“å­˜é¢„çƒ­
curl -X POST http://localhost:8000/api/trigger/warmup
```

### é—®é¢˜ï¼šè¯·æ±‚é¢‘ç¹å¤±è´¥

**æ£€æŸ¥é¡¹**ï¼š
1. æ•°æ®æºé…ç½®æ˜¯å¦æ­£ç¡®
2. API é™æµæ˜¯å¦è§¦å‘
3. ç½‘ç»œæ˜¯å¦ç¨³å®š

**è§£å†³æ–¹æ³•**ï¼š
1. åˆ‡æ¢æ•°æ®æºï¼šSettings -> æ•°æ®æºé€‰æ‹©
2. å¢åŠ é‡è¯•æ¬¡æ•°ï¼ˆä¿®æ”¹ `MAX_RETRIES`ï¼‰
3. å»¶é•¿è¯·æ±‚é—´éš”ï¼ˆä¿®æ”¹ `time.sleep`ï¼‰

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
1. [ ] æ·»åŠ  Redis ç¼“å­˜æ”¯æŒï¼ˆæŒä¹…åŒ–ï¼‰
2. [ ] å®ç°æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰
3. [ ] ä¼˜åŒ–å¤§æ•°æ®é‡çš„æ¸²æŸ“æ€§èƒ½

### ä¸­æœŸï¼ˆ1-2æœˆï¼‰
1. [ ] å®ç° CDN é™æ€èµ„æºåŠ é€Ÿ
2. [ ] æ·»åŠ è¯·æ±‚é˜Ÿåˆ—å’Œä¼˜å…ˆçº§
3. [ ] å®ç°å¢é‡æ•°æ®æ›´æ–°

### é•¿æœŸï¼ˆ3-6æœˆï¼‰
1. [ ] å¾®æœåŠ¡æ¶æ„æ‹†åˆ†
2. [ ] å®æ—¶ WebSocket æ¨é€
3. [ ] AI é¢„æµ‹æ€§é¢„åŠ è½½

## ğŸ“š ç›¸å…³æ–‡ä»¶

### åç«¯ä¿®æ”¹æ–‡ä»¶
- `api/services/index_overview.py` - å¹¶å‘åŠ è½½æŒ‡æ•°
- `api/services/market.py` - å‡å°‘å»¶è¿Ÿ
- `api/services/cache.py` - å»¶é•¿ç¼“å­˜æ—¶é—´
- `api/services/fund_flow.py` - ç¼“å­˜ä¼˜åŒ–
- `api/services/concepts.py` - ç¼“å­˜ä¼˜åŒ–

### å‰ç«¯ä¿®æ”¹æ–‡ä»¶
- `web/src/services/dataCache.js` - è¶…æ—¶å’Œé‡è¯•æœºåˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
1. é¡¹ç›®æ–‡æ¡£ï¼š`docs/README.md`
2. API æ–‡æ¡£ï¼š`http://localhost:8000/docs`
3. GitHub Issues

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2026-01-30
**ä¼˜åŒ–ç‰ˆæœ¬**: v2.1.0
**æµ‹è¯•çŠ¶æ€**: âœ… å·²é€šè¿‡
